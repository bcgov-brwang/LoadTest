<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var interval;
            var globalSampleTestUrl = "https://api.stackexchange.com/2.2/questions?order=desc&sort=activity&site=stackoverflow";
            var queue = [];
            var globalElapsedTime;

            function getUrl() {
                return $.trim($("#txtAjayUrl").val());
            }

            $("#btnLaunchRequests").on("click", function () {
                queue = [];
                $("#divTimeElapsed").html("<i>calculating</i>");
                globalElapsedTime = window.performance.now();
                $("#divRequestStatus").show();
                $("#btnLaunchRequests").prop("disabled", true);
                var totalRequests = 50;
                var inputValue = $("#txtNumberOfConcurrentRequests").val();
                totalRequests = inputValue.trim();

                $("#divTotalNumberOfProcessed").html(totalRequests.toString());
                if (interval != null && interval != undefined) {
                    clearInterval(interval);
                }
                interval = window.setInterval(function () {
                    $("#divNumberOfCurrentRequests").text(queue.length);
                }, 500);

                for (let i = 1; i <= totalRequests; i++) {
                    console.log("Loop No. " + i);
                    if (i == totalRequests) {
                        $.get(getUrl(), function (data) {
                            queue.push("1");
                            $("#btnLaunchRequests").prop("disabled", false);
                            $("#divNumberOfCurrentRequests").text(queue.length);
                            //clearInterval(interval);
                        }).always(function () {
                            $("#btnLaunchRequests").prop("disabled", false);
                            globalElapsedTime = window.performance.now() - globalElapsedTime;
                            globalElapsedTime = Math.round((globalElapsedTime / 1000) * 100) / 100;
                            console.log("%cLast Result Processed in " + globalElapsedTime + " Seconds.", "color:green");
                            $("#divTimeElapsed").text(globalElapsedTime + " seconds");
                        });
                    }
                    else {
                        $.get(getUrl(), function (data) {
                            queue.push("1");
                        });
                    }
                }
            });
        });
    </script>


    <title></title>
</head>
<body>

    <div class="container">
        <div class="row" style="padding-top:50px;">
            <div class="col-sm-12">
                <h3>HTTP GET Concurrent Requests Tester</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <ul>
                    <li>
                        Sample Ajax URL for concurrent request testing: <input type="text" id="txtAjayUrl"
                                                                               value="https://api.stackexchange.com/2.2/questions?order=desc&sort=activity&site=stackoverflow" style="width:100%" /> <br /><br />
                    </li>

                    <li>
                        <input type="number" value="10" id="txtNumberOfConcurrentRequests" /> <input type="button"
                                                                                                     value="Launch Concurrent Requests" id="btnLaunchRequests" /> <br />
                    </li>

                </ul>
            </div>
        </div>

        <div class="row" id="divRequestStatus" style="display:none">
            <div class="col-sm-12">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Total Number of Requests
                            </th>
                            <th>
                                Total Number of Requests Processed
                            </th>
                            <th>
                                Total Time Elapsed
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div id="divTotalNumberOfProcessed"></div>
                            </td>
                            <td>
                                <div id="divNumberOfCurrentRequests" style="font-weight: bolder;"></div>
                            </td>
                            <td>
                                <div id="divTimeElapsed"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>